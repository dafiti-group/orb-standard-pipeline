description: |
  Merge manifest job to build and push docker image to AWS ECR
  Needs:
    context: [DEFAULT]
parameters:
  build_tag:
    type: string
    default: "$(echo ${CIRCLE_SHA1:0:7})"
    description: |
      The artifact tag name or names comma separated
      Default value is the first 7 characters of current commit tag
  runner:
    type: executor
    default: base
    description: |
      base image to run the pipeline
      To use a customized runner, see this documentation https://circleci.com/docs/reusing-config#executor
      Use CircleCI images -> https://circleci.com/developer/images
executor: <<parameters.runner>>
steps:
  - config_docker
  - aws-ecr/ecr-login
  - run:
      name: Create merge Manifest
      environment:
              BUILD_TAG: <<parameters.build_tag>>
      command: <<include(scripts/merge-manifest.sh)>>
