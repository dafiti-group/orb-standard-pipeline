description: "Bearer Security scanner"
parameters:
  version:
    description: "Specify the Bearer version to use. This must match a Bearer release name."
    default: ""
    type: string
  scanner:
    description: "Specify the comma separated scanners e.g. --scanner secrets,sast"
    default: "secrets,sast"
    type: string
  config_file:
    description: "configuration file path"
    default: ""
    type: string
  bearer_ignore_file:
    description: "bearer.ignore file path"
    default: ""
    type: string
  only_rule:
    description: "Specify the comma-separated ids of the rules you would like to run. Skips all other rules."
    default: ""
    type: string
  skip_rule:
    description: "Specify the comma-separated ids of the rules you would like to skip. Runs all other rules."
    default: ""
    type: string
  skip_path:
    description: "Specify the comma separated files and directories to skip. Supports * syntax, e.g. --skip-path users/*.go,users/admin.sql"
    default: ""
    type: string
  exclude_fingerprint:
    description: "Specify the comma-separated fingerprints of the findings you would like to exclude from the report."
    default: ""
    type: string
  severity:
    description: "Specify which severities are included in the report as a comma separated string"
    default: ""
    type: string
  format:
    description: "Specify which format to use for the report (json, yaml, sarif, gitlab-sast)"
    default: "rdjson"
    type: string
  output:
    description: "Specify where to store the report"
    default: "rd.json"
    type: string
  api_key:
    description: "For use with Bearer Cloud"
    default: ""
    type: string
  diff:
    description: "Enable differential scanning. Only supported for pull request events"
    default: "true"
    type: string
  quiet:
    description: "Suppress non-essential messages"
    default: ""
    type: string
  hide_progress_bar:
    description: "Hide progress bar from output"
    default: "true"
    type: string
  exit_code:
    description: "Forces the exit-code when errors are reported"
    default: "0"
    type: string
  path:
    description: "The path to scan"
    default: "."
    type: string
executor: golang
steps:
  - checkout
  - config_git
  - github-cli/setup
  - run:
      name: install and run bearer scanner
      environment:
        BEARER_VERSION: <<parameters.version>>
        BEARER_SCANNER: <<parameters.scanner>>
        BEARER_CONFIG_FILE: <<parameters.config_file>>
        BEARER_IGNORE_FILE: <<parameters.bearer_ignore_file>>
        BEARER_ONLY_RULE: <<parameters.only_rule>>
        BEARER_SKIP_RULE: <<parameters.skip_rule>>
        BEARER_SKIP_PATH: <<parameters.skip_path>>
        BEARER_EXCLUDE_FINGERPRINT: <<parameters.exclude_fingerprint>>
        BEARER_FORMAT: <<parameters.format>>
        BEARER_OUTPUT: <<parameters.output>>
        BEARER_EXIT_CODE: <<parameters.exit_code>>
        BEARER_SEVERITY: <<parameters.severity>>
        BEARER_API_KEY: <<parameters.api_key>>
        BEARER_QUIET: <<parameters.quiet>>
        BEARER_HIDE_PROGRESS_BAR: <<parameters.hide_progress_bar>>
        BEARER_PATH: <<parameters.path>>
      command: <<include(scripts/bearer.sh)>>
