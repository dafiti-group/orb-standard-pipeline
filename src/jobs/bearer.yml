description: "Bearer Security scanner"
executor: machine
steps:
  - checkout
  - config_git
  - run:
      name: Install Bearer and dependencies
      command: <<include(scripts/bearer.sh)>>
  - run:
      name: Run Bearer scan
      command: /tmp/bearer scan . --diff --format=rdjson --output=rd.json || export BEARER_EXIT=$?
  - run:
      name: Run ReviewDog (comment PR)
      command: |
        cat rd.json | /tmp/reviewdog -f=rdjson -reporter=github-pr-review
        exit $BEARER_EXIT
