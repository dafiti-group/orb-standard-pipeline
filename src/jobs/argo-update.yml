parameters:
  argo_path:
    type: string
    description: >
      The path in argo repo to navigate to and change image tag ref for
      your application
  target_env:
    type: string
  mentions:
    type: string
    default: ""
    description: The team or user ID to be mentioned in slack channel
  gitops:
    type: string
    default: argo
    description: A parameter to command clone_gitops repo
executor: small
steps:
  - config_git
  - clone_gitops:
      gitops: <<parameters.gitops>>
  - run:
      name: change value in argo repo
      environment:
        PARAMETER_ARGO_PATH: <<parameters.argo_path>>
        PARAMETER_TARGET_ENV: <<parameters.target_env>>
        PARAMETER_ROLLBACK: <<pipeline.parameters.rollback>>
        PARAMETER_VERSION: <<pipeline.parameters.version>>
      command: <<include(scripts/argo-update.sh)>>
  - slack/notify:
      event: fail
      mentions: <<parameters.mentions>>
      custom: <<include(templates/fail.json)>>
